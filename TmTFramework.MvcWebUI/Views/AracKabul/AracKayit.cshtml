

@section headust{
    <link rel="stylesheet" href="/content/bower_components/select2/dist/css/select2.min.css">
}

@section head{
    <link rel="stylesheet" href="~/content/bower_components/bootstrap-daterangepicker/daterangepicker.css">
    }

<section class="content-header">
    <h1>
        Araç Kabul
    </h1>
</section>


@using (Ajax.BeginForm(null, null, new AjaxOptions { HttpMethod = "POST", OnFailure = "Hatali", OnSuccess = "Basarili" }, new { id = "formKapsayici" }))
{

    @Html.AntiForgeryToken()
    <section class="content">
        <div class="box box-default">
            <div class="box-body">
                <div class="row">
                    <div class="col-md-12">
                        <div class="form-group">
                            <label>Plaka</label>
                            @Html.DropDownList("AracId", null, "-- Seçiniz --", htmlAttributes: new { @class = "form-control  select2", placeholder = "Plaka" })

                        </div>
                    </div>
                    <div class="col-md-6 gizle">
                        <div class="form-group">
                            <label>Müşteri Ad Soyad</label>
                            <input type="text" class="form-control" disabled id="MusteriAdSoyad" placeholder="Müşteri Ad Soyad">
                        </div>
                        <div class="form-group">
                            <label>Marka</label>
                            <input type="text" class="form-control" disabled id="Marka" placeholder="Marka">
                        </div>
                    </div>
                    <div class="col-md-6 gizle">
                        <div class="form-group">
                            <label>Model</label>
                            <input type="text" class="form-control" disabled id="Model" placeholder="Model">
                        </div>
                        <div class="form-group">
                            <label>Yılı</label>
                            <input type="text" class="form-control" disabled id="Yil" placeholder="Model">
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="box box-default" id="myP">
            <div class="box-body">
                <div class="row">
                    <div class="col-md-6">
                        <div class="form-group">
                            <label>Arıza Kategorisi</label>
                            @Html.DropDownList("ArizaKategoriId", null, "-- Seçiniz --", htmlAttributes: new { @class = "form-control   select2 ", placeholder = "Arıza Kategori" })
                        </div>

                        <div class="form-group">
                            <label>Sorumlu Personel</label>
                            @Html.DropDownList("SorumluPersonelId", null, "-- Seçiniz --", htmlAttributes: new { @class = "form-control select2", placeholder = "Personel" })
                        </div>
                        <div class="form-group">

                            <label>Tahmni Süre</label>
                            <div class="input-group">


                                <div class="input-group-addon">
                                    <i class="fa fa-clock-o"></i>
                                </div>
                                <input type="text" name="tahminiSure" value=""  class="form-control pull-right" id="tahminiSure">
                            </div>
                        </div>
                    </div>

                    <div class="col-md-6">
                        <div class="form-group">
                            <label>Arıza Açıklaması</label>
                            <textarea class="form-control" id="arizaKayitAciklama" rows="8" placeholder="Açıklama..."></textarea>
                        </div>

                    </div>
                </div>
                <div class="clearfix"></div>
                <hr />
                <div class="clearfix"></div>
                <div class="col-md-12">
                    <div class="form-group">
                        <label class="btn btn-block btn-success pull-right aracArizaKayitTablosunaEkle">Arıza Kategorisi Ekle</label>
                    </div>
                </div>

                <div class="clearfix"></div>
                <hr />
                <div class="clearfix"></div>
                <div class="row">
                    <div class="col-md-12">
                        <table class="table table-hover table" id="aracArizaKayitTablosu">
                            <thead>
                                <tr>
                                    <th>Ariza Kategorisi</th>
                                    <th>Sorumlu Personel</th>
                                    <th>Başlama - Bitiş Tarihi ve Saati</th>
                                    <th>Açıklama</th>
                                    <th>işlemler</th>
                                </tr>
                            </thead>
                            <tbody id="aracArizaKayitTablosuBody"></tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
        <div class="box-footer gizle" id="mySave">
            <button type="reset" class="btn btn-default">İptal</button>
            <button type="submit" class="btn btn-info pull-right">Kaydet</button>
        </div>
    </section>


}

@section scripts{

    <script src="/Content/bower_components/select2/dist/js/select2.full.min.js"></script>
    <script src="~/content/bower_components/bootstrap-datepicker/dist/js/bootstrap-datepicker.min.js"></script>

    <script>
        //saveKontrol();
        document.getElementById("myP").style.visibility = "hidden";
        $('.gizle').hide();
       
        var arizaIndex = 1;
        $(function () {
            $('.select2').select2();

          
            $("#AracId").change(function () {
                var aracId = null;
                aracId = $('#AracId').val();
                if (aracId==='')
                { $('.gizle').hide(); $('#gizle').hide(); }
                var URL = '@Url.Action("AracKayitBilgi")/' + $('#AracId').val();
                $.getJSON(URL, function (response) {
                    console.log(response);
                    $("#MusteriAdSoyad").val(response.data.MusteriAdi);
                    $("#Marka").val(response.data.Marka);
                    $("#Model").val(response.data.Model);
                    $("#Yil").val(response.data.Yil);
                    $('.gizle').show();
                    document.getElementById("myP").style.visibility = "visible";

                })
            });

            $('.aracArizaKayitTablosunaEkle').click(function () {

                console.log($('#ArizaKategoriId').val());

                if ($('#ArizaKategoriId').val() === '' ||
                    $('#ArizaKategoriId').val() === null
                    ) {
                    toastr.warning("Arıza seçimi yapılmalıdır.");
                    return;
                }


                // <input type="hidden" id="arizaIndex" value="'+arizaIndex+'" name="arizaIndex" />
                var satir =
                    '<tr><td>' +  $('#ArizaKategoriId option:selected').text() +
                    '</td><td>' + $('#SorumluPersonelId option:selected').text() +
                    '</td><td>' + $('#tahminiSure').val() +
                    '</td><td>' + $('#arizaKayitAciklama').val() +
                    '</td><td>' +

                    '<input type="hidden" id="arizaIndex" value="' + arizaIndex + '" name="arizaIndex" />' +

                    '<input type="hidden" id="arizaKayitAciklama' + arizaIndex + '" value="' + $('#arizaKayitAciklama').val() + '" name="tahminiSure' + arizaKayitAciklama + '" />' +
                    '<input type="hidden" id="tahminiSure' + arizaIndex + '" value="' + $('#tahminiSure').val() + '" name="tahminiSure' + arizaIndex + '" />' +
                    '<input type="hidden" id="SorumluPersonelId' + arizaIndex + '" value="' + $('#SorumluPersonelId option:selected').val() + '" name="SorumluPersonelId' + arizaIndex + '" />' +
                    '<input type="hidden" id="ArizaKategoriId' + arizaIndex + '" value="' + $('#ArizaKategoriId option:selected').val() + '" name="ArizaKategoriId' + arizaIndex + '" />' +
                    '<button onclick="$(this).parent().parent().remove();saveKontrol();" class="btn btn-sm btn-danger"> <i class="fa fa-trash"></i>Sil</button>'
                    +'</td></tr>';

                if ($('#aracArizaKayitTablosuBody tr:last').length < 1) {
                    $('#aracArizaKayitTablosuBody').append(satir);

                } else {
                    $('#aracArizaKayitTablosuBody tr:last').after(satir);
                }
                arizaIndex += 1;
                $('#ArizaKategoriId').select2("val", "-- Seçiniz --");;
                $('#arizaKayitAciklama').val('');
                $('#SorumluPersonelId').select2("val", "-- Seçiniz --");;
                $('#tahminiSure').val('');
                saveKontrol();
                
            });

           
        });

        saveKontrol = function () {
            if ($('#aracArizaKayitTablosuBody tr:last').length < 1) {
                document.getElementById("mySave").style.visibility = "hidden";
            } else {
                document.getElementById("mySave").style.visibility = "visible";
            }
        }


        function Basarili(cevap) {
            if (cevap.sonuc) {
                toastr.success(cevap.mesaj);
                sayfaTemizle();
            } else {
                toastr.error(cevap.mesaj);
            }
        };
        function Hatali(cevap) {
            console.log(cevap);
            errorAlert2(cevap)
        };
        function PencereKapat() {
            MustangModal.close();
        };


        sayfaTemizle = function () {
           
            $('#AracId').select2("val", "-- Seçiniz --");
            $('#ArizaKategoriId').select2("val", "-- Seçiniz --");
            $('#arizaKayitAciklama').val('');
            $('#SorumluPersonelId').select2("val", "-- Seçiniz --");
            $('#tahminiSure').val('');
            document.getElementById("myP").style.visibility = "hidden";
            $("#aracArizaKayitTablosuBody").empty();
            $('.gizle').hide();
            arizaIndex = 1;
        }

    </script>


}